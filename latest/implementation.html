<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implementation details · CategoricalArrays</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/highlightjs/default.css" rel="stylesheet" type="text/css"/><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="index.html"><img class="logo" src="assets/logo.png" alt="CategoricalArrays logo"/></a><h1>CategoricalArrays</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="index.html">Overview</a></li><li><a class="toctext" href="using.html">Using CategoricalArrays</a></li><li class="current"><a class="toctext" href="implementation.html">Implementation details</a><ul class="internal"></ul></li><li><a class="toctext" href="functionindex.html">Index</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href="implementation.html">Implementation details</a></li></ul><a class="edit-page" href="https://github.com/JuliaData/CategoricalArrays.jl/tree/b1190599c37faea52dd8a77d45c449bf6a75c4ed/docs/src/implementation.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Implementation details</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Implementation-details-1" href="#Implementation-details-1">Implementation details</a></h1><p><code>CategoricalArray</code> and <code>NullableCategoricalArray</code> share a common implementation for the most part, with the main differences being their element types. They are based on the <code>CategoricalPool</code> type, which keeps track of the levels and associates them with an integer reference (for internal use). They offer methods to set levels, change their order while preserving the references, and efficiently get the integer index corresponding to a level and vice-versa. They are also parameterized on the type used to store the references, so that small pools can use as little memory as possible. Finally, they keep a vector of value objects (<code>CategoricalValue</code>), so that <code>getindex</code> can return the existing object instead of allocating a new one.</p><p>Array types are made of two fields:</p><ul><li><p><code>refs</code>: an integer vector giving the index of the level in the pool for each element. For <code>NullableCategoricalArray</code>, <code>0</code> indicates a missing value.</p></li><li><p><code>pool</code>: the <code>CategoricalPool</code> object keeping the levels of the array.</p></li></ul><p>Whether an array (and its values) are ordered or not is stored as a property of the pool.</p><p><code>CategoricalPool</code> is designed to limit the need to go over all elements of the vector, either for reading or for writing. This is why unused levels are not dropped automatically (this would force checking all elements on every modification or keeping a counts table), but only when <code>droplevels!</code> is called. <code>levels</code> is a (very fast) O(1) operation since it merely returns the (ordered) vector of levels without accessing the data at all. </p><p>Another useful property is that integer indices referring to levels are preserved when adding or reordering levels: the order of levels exposed to the user by the <code>levels</code> function does not necessarily match these internal indices, which are stored in the <code>index</code> field of the pool. This means a reordering of the levels is also an O(1) operation. On the other hand, deleting levels may change the indices and therefore requires iterating over all elements in the array to update the references.</p><footer><hr/><a class="previous" href="using.html"><span class="direction">Previous</span><span class="title">Using CategoricalArrays</span></a><a class="next" href="functionindex.html"><span class="direction">Next</span><span class="title">Index</span></a></footer></article></body></html>
